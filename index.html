<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ç´¢å°¼å¾½ç« æ‰¹é‡æŸ¥è¯¢ï¼ˆé™†ç»­æ›´æ–°ï¼‰</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      max-width: 100%;
      margin: auto;
      padding: 30px;
      background: #fdfdfd;
    }
    textarea {
      width: 100%;
      height: 160px;
      margin-bottom: 10px;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      color: #333;
    }
    button, .link-btn {
      padding: 10px 20px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      text-decoration: none;
      margin-right: 10px;
      display: inline-block;
    }
    button:disabled {
      background: #9e9e9e;
      cursor: not-allowed;
    }
    .table-wrapper {
      width: 100%;
      overflow-x: auto;
    }
    table {
      margin-top: 20px;
      border-collapse: collapse;
      font-size: 14px;
      white-space: nowrap;
      min-width: 1600px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: center;
    }
    th {
      background: #f0f0f0;
    }
    .success { background-color: #e8f5e9; }
    .fail { background-color: #f9f9f9; color: #999; }
    .footer {
      margin-top: 40px;
      text-align: right;
      font-size: 13px;
    }
    .summary {
      margin-top: 10px;
      font-weight: bold;
      font-size: 15px;
    }
  </style>
</head>
<body>
  <h2>ç´¢å°¼å¾½ç« æ‰¹é‡æŸ¥è¯¢ï¼ˆé™†ç»­æ›´æ–°ï¼‰</h2>
  <p>æ¯è¡Œä¸€ä¸ªé’±åŒ…åœ°å€ï¼š</p>
  <textarea id="input" placeholder=""></textarea><br>
  <button id="queryBtn" onclick="check()">å¼€å§‹æŸ¥è¯¢</button>
  <a href="https://badge.sonus.exchange/claim" target="_blank" class="link-btn">ğŸ é¢†å– Sonus å¾½ç« </a>
  <a href="https://soneiumevent.unemeta.com/mint" target="_blank" class="link-btn">ğŸ é¢†å– Unemeta å¾½ç« </a>
  <a href="https://owlto.finance/soneium-badge" target="_blank" class="link-btn">ğŸ é¢†å– Owlto å¾½ç« </a>
  <a href="https://app.wavex.fi/rewards" target="_blank" class="link-btn">ğŸ é¢†å– WaveX å¾½ç« </a>

  <div class="summary" id="sonusQualified"></div>
  <div class="summary" id="kyoHolders"></div>
  <div class="summary" id="sakeHolders"></div>
  <div class="summary" id="sonusHolders"></div>
  <div class="summary" id="ogHolders"></div>
  <div class="summary" id="unemetaHolders"></div>
  <div class="summary" id="owltoHolders"></div>
  <div class="summary" id="sonovaHolders"></div>
  <div class="summary" id="orbiterHolders"></div>
  <div class="summary" id="velodromeHolders"></div>
  <div class="summary" id="wavexHolders"></div>
  <div class="summary" id="untitledBankHolders"></div>
  <div class="summary" id="sonefiHolders"></div>
  <div class="summary" id="quickHolders"></div>
  <div class="summary" id="summary"></div>

  <div class="table-wrapper">
    <table id="resultTable" style="display:none;">
      <thead>
        <tr>
          <th>åºå·</th>
          <th>åœ°å€</th>
          <th>KYO å¾½ç« </th>
          <th>Sake å¾½ç« </th>
          <th>Sonusèµ„æ ¼</th>
          <th>Sonuså¾½ç« </th>
          <th>Orbiter å¾½ç« </th>
          <th>OG å¾½ç« </th>
          <th>Unemeta å¾½ç« </th>
          <th>Owlto å¾½ç« </th>
          <th>Sonova å¾½ç« </th>
          <th>Velodrome å¾½ç« </th>
          <th>WaveX èµ„æ ¼</th>
          <th>WaveX å¾½ç« </th>
          <th>UntitledBank å¾½ç« </th>
          <th>SoneFi å¾½ç« </th>
          <th>Quick å¾½ç« </th>
        </tr>
      </thead>
      <tbody id="resultBody"></tbody>
    </table>
  </div>
  <div class="footer">
    ä½œè€…æ¨ç‰¹ï¼š<a href="https://x.com/0xXIAOc" target="_blank">@0xXIAOc</a>
  </div>

  <script>
    // å„NFTåˆçº¦åœ°å€
    const kyoNFT = "0x11b2876c58cfb7501db60d0112af8a8efeb0a81d";
    const sakeNFT = "0x3a634e6f8c2bf2c5894722b908d99e3cf9c62ed3";
    const sonusNFT = "0x066aba7c3520e300113c0515ff41c084ee0c95ea";
    const ogNFT = "0x2A21B17E366836e5FFB19bd47edB03b4b551C89d";
    const unemetaNFT = "0xCA707D22E248740aDaA9C63580F7A35201B18d30";
    const owltoNFT = "0x1eC6AACC79f3c4817d7fea2268e1c54C6b2662Fb";
    const sonovaNFT = "0x4A33e2E308E5d9C0188d209F1bF443Ff7CfB4A31";
    const orbiterNFT = "0xc59f0D1B1b614d8446dDe1760fc3e6ae57bF9501";
    const velodromeNFT = "0x2DCD9B33F0721000Dc1F8f84B804d4CFA23d7713";
    const wavexNFT = "0x4a3b67b339c272fab639b0caf3ce7852b2aa0833";
    const untitledBankNFT = "0xcf87B2d5Ab008D41159f6737E2a5b6a3Bc40b753";
    const sonefiNFT = "0x6DD843fe15dbFD41F001d448cb246ac8b65a6027";
    // æ–°å¢ Quickå¾½ç«  åˆçº¦åœ°å€
    const quickNFT = "0x5C0221a8c3eB5956b70cDC572fA0F6C952274f1A";

    let sonusBadgeSet = new Set();

    async function fetchBadgeHolders() {
      const badgeAPIs = [
        { url: `https://soneium.blockscout.com/api/v2/tokens/${ogNFT}`, id: "ogHolders" },
        { url: `https://soneium.blockscout.com/api/v2/tokens/${sakeNFT}`, id: "sakeHolders" },
        { url: `https://soneium.blockscout.com/api/v2/tokens/${kyoNFT}`, id: "kyoHolders" },
        { url: `https://soneium.blockscout.com/api/v2/tokens/${sonusNFT}`, id: "sonusHolders" },
        { url: `https://soneium.blockscout.com/api/v2/tokens/${unemetaNFT}`, id: "unemetaHolders" },
        { url: `https://soneium.blockscout.com/api/v2/tokens/${owltoNFT}`, id: "owltoHolders" },
        { url: `https://soneium.blockscout.com/api/v2/tokens/${sonovaNFT}`, id: "sonovaHolders" },
        { url: `https://soneium.blockscout.com/api/v2/tokens/${orbiterNFT}`, id: "orbiterHolders" },
        { url: `https://soneium.blockscout.com/api/v2/tokens/${velodromeNFT}`, id: "velodromeHolders" },
        { url: `https://soneium.blockscout.com/api/v2/tokens/${wavexNFT}`, id: "wavexHolders" },
        { url: `https://soneium.blockscout.com/api/v2/tokens/${untitledBankNFT}`, id: "untitledBankHolders" },
        { url: `https://soneium.blockscout.com/api/v2/tokens/${sonefiNFT}`, id: "sonefiHolders" },
        // æ–°å¢ Quickå¾½ç« æŸ¥è¯¢
        { url: `https://soneium.blockscout.com/api/v2/tokens/${quickNFT}`, id: "quickHolders" }
      ];
      for (let { url, id } of badgeAPIs) {
        try {
          const response = await fetch(url);
          const data = await response.json();
          document.getElementById(id).innerText = `ğŸ“Š å½“å‰æŒæœ‰ ${id.replace('Holders', '')} å¾½ç« çš„é’±åŒ…æ•°ï¼š${data.holders}`;
        } catch (err) {
          document.getElementById(id).innerText = `âŒ æ— æ³•åŠ è½½ ${id} æ•°æ®ï¼š${err.message}`;
        }
      }
    }

    async function loadSonusBadgeData() {
      try {
        const res = await fetch("https://badge.sonus.exchange/static/js/main.dace8027.js");
        const text = await res.text();
        const matches = text.match(/"0x[a-fA-F0-9]{40}":1/g);
        if (matches) {
          matches.forEach(match => {
            const addr = match.slice(1, 43).toLowerCase();
            sonusBadgeSet.add(addr);
          });
        }
        document.getElementById("sonusQualified").innerText = `ğŸ“¦ Sonus å¾½ç«  ç¬¦åˆèµ„æ ¼äººæ•°ï¼š${sonusBadgeSet.size}`;
      } catch (err) {
        document.getElementById("sonusQualified").innerText = `âŒ æ— æ³•åŠ è½½ Sonusèµ„æ ¼æ•°æ®ï¼š${err.message}`;
      }
    }

    async function check() {
      const raw = document.getElementById("input").value.trim();
      const addresses = raw.split("\n").map(x => x.trim()).filter(Boolean);
      if (!addresses.length) return alert("è¯·è¾“å…¥åœ°å€");

      const btn = document.getElementById("queryBtn");
      const tbody = document.getElementById("resultBody");
      const table = document.getElementById("resultTable");
      const summary = document.getElementById("summary");

      btn.innerText = "æŸ¥è¯¢ä¸­...";
      btn.disabled = true;
      tbody.innerHTML = "";
      table.style.display = "table";
      summary.innerText = "";

      let kyoCount = 0, sakeCount = 0, sonusListCount = 0, sonusNFTCount = 0, orbiterCount = 0, ogCount = 0,
          unemetaCount = 0, owltoCount = 0, sonovaCount = 0, velodromeCount = 0,
          wavexCount = 0, wavexNFTCount = 0, untitledBankCount = 0, sonefiCount = 0,
          quickCount = 0;  // æ–°å¢ Quick å¾½ç« è®¡æ•°

      for (let i = 0; i < addresses.length; i++) {
        const addr = addresses[i];
        let checksumAddr;
        try {
          checksumAddr = ethers.utils.getAddress(addr);
        } catch {
          const row = document.createElement("tr");
          row.className = "fail";
          row.innerHTML = `<td>${i + 1}</td><td>${addr}</td><td colspan="17">âŒ åœ°å€æ ¼å¼é”™è¯¯</td>`;
          tbody.appendChild(row);
          continue;
        }

        const row = document.createElement("tr");
        let hasKyo = false, hasSake = false, hasSonusNFT = false, hasOG = false,
            hasUnemeta = false, hasOwlto = false, hasSonova = false, hasOrbiter = false, hasVelodrome = false,
            hasWavex = false, hasWavexNFT = false, hasUntitledBank = false, hasSonefi = false;
        let hasQuick = false;
        const hasSonusList = sonusBadgeSet.has(addr.toLowerCase());

        try {
          const res721 = await fetch(`https://soneium.blockscout.com/api/v2/addresses/${checksumAddr}/tokens?type=ERC-721`);
          const json721 = await res721.json();
          const items721 = json721.items || [];
          const checkNFT = (nft) => items721.some(item => item.token?.address?.toLowerCase() === nft.toLowerCase());

          hasKyo = checkNFT(kyoNFT); if (hasKyo) kyoCount++;
          hasSake = checkNFT(sakeNFT); if (hasSake) sakeCount++;
          hasSonusNFT = checkNFT(sonusNFT); if (hasSonusNFT) sonusNFTCount++;
          hasOrbiter = checkNFT(orbiterNFT); if (hasOrbiter) orbiterCount++;
          hasUnemeta = checkNFT(unemetaNFT); if (hasUnemeta) unemetaCount++;
          hasSonova = checkNFT(sonovaNFT); if (hasSonova) sonovaCount++;
          hasVelodrome = checkNFT(velodromeNFT); if (hasVelodrome) velodromeCount++;
          hasWavexNFT = checkNFT(wavexNFT); if (hasWavexNFT) wavexNFTCount++;
          hasUntitledBank = checkNFT(untitledBankNFT); if (hasUntitledBank) untitledBankCount++;
          // æ–°å¢ Quick å¾½ç« æ£€æµ‹
          hasQuick = checkNFT(quickNFT); if (hasQuick) quickCount++;

          // æ–°å¢ï¼šç¬¦åˆ Sonus èµ„æ ¼çš„åœ°å€è®¡æ•°
          if (hasSonusList) sonusListCount++;

          const res1155 = await fetch(`https://soneium.blockscout.com/api/v2/addresses/${checksumAddr}/tokens?type=ERC-1155`);
          const json1155 = await res1155.json();
          const items1155 = json1155.items || [];
          hasOG = items1155.some(item => item.token?.address?.toLowerCase() === ogNFT.toLowerCase());
          if (hasOG) ogCount++;

          hasOwlto = items1155.some(item => item.token?.address?.toLowerCase() === owltoNFT.toLowerCase());
          if (hasOwlto) owltoCount++;

          hasSonefi = items1155.some(item => item.token?.address?.toLowerCase() === sonefiNFT.toLowerCase());
          if (hasSonefi) sonefiCount++;

          const resWavex = await fetch(`https://wavex-fi.vercel.app/api/proxy?address=${checksumAddr}`);
          const jsonWavex = await resWavex.json();
          hasWavex = jsonWavex && Array.isArray(jsonWavex.data) && jsonWavex.data.length > 10;
          if (hasWavex) wavexCount++;

        } catch (e) {
          row.className = "fail";
          row.innerHTML = `<td>${i + 1}</td><td>${addr}</td><td colspan="17">âŒ æŸ¥è¯¢å¤±è´¥</td>`;
          tbody.appendChild(row);
          continue;
        }

        row.className = (hasKyo || hasSake || hasSonusList || hasSonusNFT || hasOrbiter || hasOG || hasUnemeta || hasOwlto || hasSonova || hasVelodrome || hasWavex || hasWavexNFT || hasUntitledBank || hasSonefi || hasQuick) ? "success" : "fail";
        row.innerHTML = 
          `<td>${i + 1}</td>
           <td>${addr}</td>
           <td>${hasKyo ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasSake ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasSonusList ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasSonusNFT ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasOrbiter ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasOG ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasUnemeta ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasOwlto ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasSonova ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasVelodrome ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasWavex ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasWavexNFT ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasUntitledBank ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasSonefi ? "âœ… æ˜¯" : "âŒ å¦"}</td>
           <td>${hasQuick ? "âœ… æ˜¯" : "âŒ å¦"}</td>`;
        tbody.appendChild(row);
      }

      summary.innerText = `âœ… æ€»åœ°å€æ•°ï¼š${addresses.length}ï¼ŒKYOï¼š${kyoCount}ï¼ŒSakeï¼š${sakeCount}ï¼ŒSonusèµ„æ ¼ï¼š${sonusListCount}ï¼ŒSonuså¾½ç« ï¼š${sonusNFTCount}ï¼ŒOrbiterï¼š${orbiterCount}ï¼ŒOGå¾½ç« ï¼š${ogCount}ï¼ŒUnemetaå¾½ç« ï¼š${unemetaCount}ï¼ŒOwltoå¾½ç« ï¼š${owltoCount}ï¼ŒSonovaå¾½ç« ï¼š${sonovaCount}ï¼ŒVelodromeå¾½ç« ï¼š${velodromeCount}ï¼ŒWaveXèµ„æ ¼ï¼š${wavexCount}ï¼ŒWaveXå¾½ç« ï¼š${wavexNFTCount}ï¼ŒUntitledBankå¾½ç« ï¼š${untitledBankCount}ï¼ŒSoneFiå¾½ç« ï¼š${sonefiCount}ï¼ŒQuickå¾½ç« ï¼š${quickCount}`;
      btn.innerText = "å¼€å§‹æŸ¥è¯¢";
      btn.disabled = false;
    }

    loadSonusBadgeData();
    fetchBadgeHolders();
  </script>
</body>
</html>
